<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>0x00 æç®€è¾¹ç•Œå€¼æ¢æµ‹ä¸åº•å±‚é‰´å®š</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.11.1/ethers.umd.min.js"></script>
    <style>
        body { font-family: monospace; max-width: 800px; margin: 20px auto; padding: 25px; background-color: #f8f9fa; color: #333; }
        h2 { border-bottom: 2px solid #dee2e6; padding-bottom: 10px; }
        button { padding: 12px 24px; margin: 10px 10px 10px 0; cursor: pointer; background-color: #0d6efd; color: white; border: none; border-radius: 6px; font-weight: bold; }
        button.exploit { background-color: #dc3545; }
        button:disabled { background-color: #adb5bd; cursor: not-allowed; }
        #console { background: #212529; color: #20c997; padding: 20px; border-radius: 8px; height: 400px; overflow-y: auto; white-space: pre-wrap; font-size: 14px; border: 1px solid #495057; line-height: 1.6;}
        .danger-text { color: #ff4d4d; font-weight: bold; }
        .safe-text { color: #0dcaf0; font-weight: bold; }
    </style>
</head>
<body>
    <h2>è¾¹ç•Œå€¼æ¢æµ‹ï¼šå•å­—èŠ‚ 0x00 ç›²ç­¾æµ‹è¯•</h2>
    
    <div>
        <button id="btnConnect">1. è¿æ¥æµ‹è¯•é’±åŒ…</button>
        å½“å‰åœ°å€: <span id="walletAddress" style="color: #0d6efd; font-weight: bold;">æœªè¿æ¥</span>
    </div>

    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px dashed #ced4da;">
        <button id="btnBypass" class="exploit" disabled>2. å‘é€çº¯ 0x00 å¹¶é‰´å®š</button>
    </div>

    <h3 style="margin-top: 30px; color: #495057;">æ¢æµ‹æ§åˆ¶å°:</h3>
    <div id="console">ç³»ç»Ÿå°±ç»ªï¼Œç­‰å¾…æ“ä½œ...</div>

    <script>
        const btnConnect = document.getElementById('btnConnect');
        const btnBypass = document.getElementById('btnBypass');
        const elAddress = document.getElementById('walletAddress');
        const elConsole = document.getElementById('console');
        let currentAccount = null;

        function log(msg) {
            elConsole.innerHTML += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
            elConsole.scrollTop = elConsole.scrollHeight;
        }

        btnConnect.addEventListener('click', async () => {
            if (window.ethereum) {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    currentAccount = accounts[0]; 
                    elAddress.innerText = currentAccount;
                    log(`âœ… é’±åŒ…è¿æ¥æˆåŠŸã€‚`);
                    btnBypass.disabled = false;
                } catch (e) { log(`âŒ è¿æ¥å¤±è´¥: ${e.message}`); }
            }
        });

        btnBypass.addEventListener('click', async () => {
            if (!currentAccount) return;
            
            // æ ¸å¿ƒï¼šæç®€ Payloadï¼Œä»…åŒ…å«ä¸€ä¸ªç©ºå­—èŠ‚
            const payload = "0x00"; 
            
            log(`\n--- ğŸš€ å‘é€æç®€è¾¹ç•Œå€¼ Payload ---`);
            log(`è¯·æ±‚ç­¾åæ•°æ®: ${payload} (å•å­—èŠ‚)`);
            
            try {
                const signature = await window.ethereum.request({
                    method: 'eth_sign',
                    params: [currentAccount, payload]
                });
                
                log(`\n<span class="danger-text">ğŸš¨ [çªç ´é˜²çº¿] é’±åŒ…ç”±äºé•¿åº¦åˆ¤æ–­ç¼ºé™·ï¼Œæœªèƒ½æ‹¦æˆªï¼æˆåŠŸæ‹¿åˆ°ç­¾å:</span>\n${signature}`);
                log(`\nğŸ” å¼€å§‹éªŒè¯åº•å±‚æ˜¯å¦å®æ–½äº†å®‰å…¨åŒ…è£…...`);
                
                verifyLogic(payload, signature, currentAccount.toLowerCase());

            } catch (error) {
                log(`ğŸ›¡ï¸ è¯·æ±‚è¢«æ‹¦æˆª: ${error.message}`);
                log(`åˆ†æï¼šé’±åŒ…é˜²ç«å¢™ä¸ä»…æ ¡éªŒæ ¼å¼ï¼Œè¿˜å¯¹æ‰€æœ‰é•¿åº¦çš„çº¯ Hex å®æ–½äº†æ— å·®åˆ«æ‹¦æˆªã€‚`);
            }
        });

        function verifyLogic(payload, signature, address) {
            if (typeof ethers === 'undefined') return;
            let resolved = false;

            // éªŒè¯ 1ï¼šæ˜¯å¦å¯¹ 0x00 è¿›è¡Œäº†ç»å¯¹è£¸ç­¾ï¼Ÿ
            try {
                if (ethers.recoverAddress(payload, signature).toLowerCase() === address) {
                    log(`\n<span class="danger-text">ğŸ’¥ [é«˜å±æ¼æ´] é‰´å®šç»“æœï¼šé’±åŒ…å¯¹ 0x00 è¿›è¡Œäº†çœŸ eth_sign è£¸ç­¾ï¼</span>`);
                    log(`ç»“è®ºï¼šæ²¡æœ‰ä»»ä½•å‰ç¼€ä¿æŠ¤ã€‚å¦‚æœæŸä¸ªæ™ºèƒ½åˆçº¦æœªä¸¥æ ¼æ ¡éªŒç­¾åé•¿åº¦å’Œå†…å®¹ï¼Œç›´æ¥ ecrecover è¿™ä¸ªå•å­—èŠ‚ç­¾åçš„ç»“æœï¼Œå¯èƒ½ä¼šè¢«æ”»å‡»ã€‚`);
                    resolved = true;
                }
            } catch(e) {}

            // éªŒè¯ 2ï¼šæ˜¯å¦è¢«è½¬æˆäº†å®‰å…¨çš„ personal_signï¼Ÿ
            if (!resolved) {
                try {
                    const bytes = ethers.getBytes(payload); // è½¬æ¢ä¸º Uint8Array([0])
                    if (ethers.verifyMessage(bytes, signature).toLowerCase() === address) {
                        log(`\n<span class="safe-text">ğŸ›¡ï¸ [å®‰å…¨é˜²å¾¡] é‰´å®šç»“æœï¼šå·²è¢«è½¬æ¢ä¸º personal_signã€‚</span>`);
                        log(`ç»“è®ºï¼šè™½ç„¶ 0x00 éª—è¿‡äº† UI å¼¹çª—ï¼Œä½†åº•å±‚ä¾ç„¶å®‰å…¨åœ°åŠ ä¸Šäº† EIP-191 æ–‡æœ¬å‰ç¼€ã€‚`);
                        resolved = true;
                    }
                } catch(e) {}
            }

            if (!resolved) {
                log(`\nâ“ [æœªçŸ¥é€»è¾‘] æ— æ³•è§£æç­¾åï¼Œåº•å±‚å¤„ç†å¼‚å¸¸ã€‚`);
            }
        }
    </script>
</body>
</html>
