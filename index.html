<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>eth_sign é˜²ç«å¢™è§„åˆ™æ¢æµ‹å™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.11.1/ethers.umd.min.js"></script>
    <style>
        body { font-family: monospace; max-width: 900px; margin: 20px auto; padding: 20px; background-color: #f4f4f9; color: #333; }
        button { padding: 12px; margin: 8px 8px 8px 0; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 6px; font-weight: bold;}
        button.bypass { background-color: #fd7e14; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        #console { background: #1e1e1e; color: #00ff00; padding: 15px; border-radius: 8px; height: 400px; overflow-y: auto; white-space: pre-wrap; font-size: 13px; }
    </style>
</head>
<body>
    <h2>eth_sign é˜²ç«å¢™ç›²åŒºæ¢æµ‹ (Bypass Probes)</h2>
    <div>
        <button id="btnConnect">1. è¿æ¥é’±åŒ…</button>
        åœ°å€: <span id="walletAddress" style="color:#007bff; font-weight:bold;">æœªè¿æ¥</span>
    </div>

    <div style="margin-top: 20px; border-top: 1px dashed #ccc; padding-top: 20px;">
        <button id="btnProbe1" class="bypass" disabled>æ¢é’ˆ 1: éæ³• Hex å­—ç¬¦æ³¨å…¥ (å¤åˆ»ç¬¬ä¸€ç‰ˆ)</button>
        <button id="btnProbe2" class="bypass" disabled>æ¢é’ˆ 2: é•¿åº¦æ¬ºéª— (æœ«å°¾è¿½åŠ  00)</button>
        <button id="btnProbe3" class="bypass" disabled>æ¢é’ˆ 3: é•¿åº¦æ¬ºéª— (é 32 å­—èŠ‚çš„çº¯ Hex)</button>
    </div>

    <h3 style="margin-top: 20px;">æ¢æµ‹æ—¥å¿—:</h3>
    <div id="console">ç­‰å¾…æ“ä½œ...</div>

    <script>
        const elAddress = document.getElementById('walletAddress');
        const elConsole = document.getElementById('console');
        let currentAccount = null;

        function log(msg) {
            elConsole.innerHTML += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
            elConsole.scrollTop = elConsole.scrollHeight;
        }

        document.getElementById('btnConnect').addEventListener('click', async () => {
            if (window.ethereum) {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    currentAccount = accounts[0]; 
                    elAddress.innerText = currentAccount;
                    log(`âœ… å·²è¿æ¥: ${currentAccount}`);
                    document.querySelectorAll('.bypass').forEach(b => b.disabled = false);
                } catch (e) { log(`âŒ è¿æ¥å¤±è´¥: ${e.message}`); }
            }
        });

        async function sendProbe(probeName, payload) {
            if (!currentAccount) return;
            log(`\n--- ğŸš€ æ‰§è¡Œ [${probeName}] ---`);
            log(`å‘é€çš„ Payload: ${payload}`);
            
            try {
                const sig = await window.ethereum.request({ method: 'eth_sign', params: [currentAccount, payload] });
                log(`ğŸš¨ [ç»•è¿‡æˆåŠŸï¼] é’±åŒ…é˜²ç«å¢™è¢«å‡»ç©¿ï¼Œæ‹¿åˆ°ç­¾å:\n${sig}`);
                
                // ç¬é—´éªŒè¯
                if(typeof ethers !== 'undefined') {
                    try {
                        const rec = ethers.recoverAddress(payload, sig).toLowerCase();
                        log(rec === currentAccount.toLowerCase() ? `ğŸ’¥ [é«˜å±] å¯†ç å­¦é‰´å®šï¼šè¿™æ˜¯çœŸæ­£çš„ eth_sign ç›²ç­¾ï¼` : `âš ï¸ é‰´å®šå¤±è´¥æˆ–å·²è¢«è½¬æ¢ä¸º personal_sign`);
                    } catch(e) { log(`â„¹ï¸ ethers.js æ— æ³•è§£æè¯¥æ ¼å¼çš„æ¢å¤ã€‚`); }
                }
            } catch (error) {
                log(`ğŸ›¡ï¸ æ‹¦æˆªæˆåŠŸ: ${error.message} (é˜²ç«å¢™é˜²ä½äº†æ­¤æ¢é’ˆ)`);
            }
        }

        // æ¢é’ˆ 1ï¼šå¤åˆ»ä½ ç¬¬ä¸€ç‰ˆèƒ½å”¤èµ·çš„åŒ…å«å­—æ¯çš„ä¼ª Hex
        document.getElementById('btnProbe1').addEventListener('click', () => {
            sendProbe("æ¢é’ˆ 1: éæ³• Hex", "0x11223344Some_evil_content");
        });

        // æ¢é’ˆ 2ï¼šç»å…¸çš„ 0x00 é•¿åº¦å¡«å……ç»•è¿‡ (32å­—èŠ‚å“ˆå¸Œ + 00)
        document.getElementById('btnProbe2').addEventListener('click', () => {
            const rawHash = "0x89c9e5fa472f883b6f007bc9543e2621c1f55b9e0f34033dfd720c24298150a0";
            sendProbe("æ¢é’ˆ 2: è¿½åŠ  00", rawHash + "00"); // å˜æˆ 33 å­—èŠ‚
        });

        // æ¢é’ˆ 3ï¼šçº¯ Hexï¼Œä½†æ•…æ„å°‘ä¸€ä¸ªå­—èŠ‚ (31å­—èŠ‚)
        document.getElementById('btnProbe3').addEventListener('click', () => {
            const shortHash = "0x89c9e5fa472f883b6f007bc9543e2621c1f55b9e0f34033dfd720c24298150"; 
            sendProbe("æ¢é’ˆ 3: 31å­—èŠ‚ Hex", shortHash);
        });
    </script>
</body>
</html>
